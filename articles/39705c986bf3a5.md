---
title: "固有値問題の数値解析（QR法）"
emoji: "🐙"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["QR法", "固有値問題"]
published: True
---
# 対象読者
これは、正則行列の固有値・固有ベクトルをプログラミングで求める方法を解説した資料です。  
この資料では「QR法」と呼ばれる方法を以下の順で解説しています。

* [グラムシュミット正規直行化法を用いて、正則行列から正規直交基底を作る](#グラムシュミット正規直行法)
* [正規直交基底を用いて、正則行列のQR分解を行う](#qr分解)
* [QR分解を繰り返し、固有値・固有ベクトルを求める](#固有値・固有ベクトルの計算)

※ヘッセンベルグ行列化を行うことで計算量を落とすことができますが、この資料では解説していません。
※QR分解とは、正方行列 $A$ を、直交行列 $Q$ と上三角行列 $R$ の積に分解することです。

# QR法について
## グラムシュミット正規直行法
まずは正則行列 $A = (\bm{a_1}, \bm{a_2}, \ldots, \bm{a_n})$ を元に、正規直交基底 $\bm{e_1}, \bm{e_2}, \ldots, \bm{e_n}$ を作る方法を紹介します。

最初の基底ベクトル $\bm{e_1}$ を以下のように定義します。

$$
\bm{e_1} = \frac{\bm{a_1}}{\|\bm{a_1}\|}
$$
次に、2 番目、3番目、それ以降の基底ベクトルを以下のように定義します。

$$
\begin{aligned}
\bm{e_2} &= \frac{\bm{a_2} - \bm{e_1}^{\mathrm{T}} \bm{a_2} \bm{e_1}}{\|\bm{a_2} - \bm{e_1}^{\mathrm{T}} \bm{a_2} \bm{e_1}\|}\\
\bm{e_3} &= \frac{\bm{a_3} - \bm{e_1}^{\mathrm{T}} \bm{a_3} \bm{e_1} - \bm{e_2}^{\mathrm{T}} \bm{a_3} \bm{e_2}}{\|\bm{a_3} - \bm{e_1}^{\mathrm{T}} \bm{a_3} \bm{e_1} - \bm{e_2}^{\mathrm{T}} \bm{a_3} \bm{e_2}\|}\\
\vdots \\
\bm{e_n} &= \frac{\bm{a_n} - \bm{e_1}^{\mathrm{T}} \bm{a_n} \bm{e_1} - \bm{e_2}^{\mathrm{T}} \bm{a_n} \bm{e_2} - \cdots - \bm{e_{n-1}}^{\mathrm{T}} \bm{a_n} \bm{e_{n-1}}}{\|\bm{a_n} - \bm{e_1}^{\mathrm{T}} \bm{a_n} \bm{e_1} - \bm{e_2}^{\mathrm{T}} \bm{a_n} \bm{e_2} - \cdots - \bm{e_{n-1}}^{\mathrm{T}} \bm{a_n} \bm{e_{n-1}}\|}\\
\end{aligned}
$$
このようにして、ベクトル $\bm{e_i}$ を今までに作成したベクトル $\bm{e_1}, \bm{e_2}, \ldots, \bm{e_{i-1}}$ と直行するように作成し、長さを $1$ にすることで、正規直交基底 $\bm{e_1}, \bm{e_2}, \ldots, \bm{e_n}$ を作ることができます。

## QR分解
続いて、先ほど考えた逆の作業、 $\bm{e_1}, \bm{e_2}, \ldots, \bm{e_n}$ を用いて $A = (\bm{a_1}, \bm{a_2}, \ldots, \bm{a_n})$ を表すことで正則行列 $A$ をQR分解することができます。

$$
\begin{aligned}
\bm{a_1} &= \bm{e_1}^{\mathrm{T}} \bm{a_1} \bm{e_1} \\
\bm{a_2} &= \bm{e_1}^{\mathrm{T}} \bm{a_2} \bm{e_1} + \bm{e_2}^{\mathrm{T}} \bm{a_2} \bm{e_2}\\
\vdots \\
\bm{a_n} &= \bm{e_1}^{\mathrm{T}} \bm{a_n} \bm{e_1} + \bm{e_2}^{\mathrm{T}} \bm{a_n} \bm{e_2} + \cdots + \bm{e_n}^{\mathrm{T}} \bm{a_n} \bm{e_n} \\
\end{aligned}
$$

これを行列の形で表すと、次のようになります。

$$
\begin{aligned}
A &= (\bm{e_1}, \bm{e_2}, \ldots, \bm{e_n})
\begin{pmatrix}
\bm{e_1}^{\mathrm{T}} \bm{a_1} & \bm{e_1}^{\mathrm{T}} \bm{a_2} & \cdots & \bm{e_1}^{\mathrm{T}} \bm{a_n} \\
0 & \bm{e_2}^{\mathrm{T}} \bm{a_2} & \cdots & \bm{e_2}^{\mathrm{T}} \bm{a_n} \\
\vdots & \vdots & \ddots & \vdots \\
0 & 0 & \cdots & \bm{e_n}^{\mathrm{T}} \bm{a_n} \\
\end{pmatrix}\\
&=QR
\end{aligned}
$$
これで $A$ を直行行列、上三角行列の積に分解したことになり、QR分解ができました。

## 固有値・固有ベクトルの計算
$$
\begin{aligned}
A_{1} &= A = Q_{1}R_{1}\\
A_{2} &= R_{1}Q_{2}\\
A_{2} &= Q_{2}R_{2}\\
\vdots \\
A_{k} &= R_{k-1}Q_{k-1}
\end{aligned}
$$
と計算すると、$k$ が十分大きいとき $A_{k}$ は上三角行列に近づき、対角成分が固有値に近づきます。

この証明に必要な定理
1. $A$ と $A_n$ の固有値は等しい
2. $A$ の固有値の絶対値がすべて異なるなら、$n \to \infty$ で $A_n$ は上三角行列に近づく
3. 三角行列の対角成分は固有値と等しい