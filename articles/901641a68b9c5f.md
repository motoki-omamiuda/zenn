---
title: "主成分分析の理論"
emoji: "🦔"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["PCA", "主成分分析", "PrincipleComponentAnalysis"]
published: False
---
# 主成分分析とは
主成分分析とは、**多次元のデータを少量の新しい変数（主成分）に変換して、データの構造をわかりやすくする統計手法**です。  
この資料は、多くの開発者が利用しているこの「主成分分析」の理論的な背景をしっかり説明することを目的として書きました。

もう少し具体的に説明すると、主成分分析とは、データの分散が大きい方向に沿った軸を見つけだすことで多次元のデータを低次元に圧縮し、ノイズや冗長な情報を減らす統計的な分析手法です。  

:::details 例えば  
生徒全員が満点を取った数学のテストと、
生徒全員ばらばらの点数を取った国語のテストがあるとします。

この場合、国語のテストのほうが「優秀な学生の判断材料」になるでしょう。  

この「ばらばら」の度合いが大きい（分散が大きい指標）ほど情報量が多い、という思想のもと考えられた次元圧縮方法が、この主成分分析です。

:::

## 問題設定
例えば、「体重」「身長」を表すデータがあったとして、これをひとつの軸で表現するとしたら、どうするが良いでしょうか？  

:::details 具体的は
実際、以下のように「体重」「身長」を表すデータがあったとして、これをひとつの軸で表現するとしたら、どうするが良いでしょうか？

![](https://storage.googleapis.com/zenn-user-upload/51115872d964-20250807.png)

おそらく、ほとんどの人はこんな風に軸をとるでしょう。  
実際に主成分分析を行うことで、「第一主成分」としてこのような軸が求まります。
![](https://storage.googleapis.com/zenn-user-upload/bde6ea1ede6f-20250807.png)


:::

では実際にこの軸を求めていきましょう。まずは、軸の向きを表す単位ベクトルを定義します。

$$
\bm{e} = (e_1, e_2)^{\mathrm{T}} \in \mathbb{R}^2, \quad \text{ただし} \quad e_1^2 + e_2^2 = 1
$$

続いて、k個のデータ点を設定しておきます。今回は、それぞれのデータが「身長」と「体重」を持っているとします。

$$
\bm{x_1} = (176, 68)^{\mathrm{T}}\\
\bm{x_2} = (165, 60)^{\mathrm{T}}\\
\vdots \\
\bm{x_k} = (163, 63)^{\mathrm{T}}
$$

では、この点をもっともばらばらに分割するベクトル $\mathbf{e}$ とはどんな風に書けるでしょうか。  
それは、内積を使って以下のように書くことができます。

$$
\bm{e} = \argmax_{\bm{e}} \sum_{i=1}^{k} (\bm{x_i} \cdot \bm{e})^2
$$

これは、データ点が最もばらばらになる $\bm{e}$ を探す、ということを意味した式になっています。

以上を準備として、改めて数式を用いてこの問題を整理すると、以下のようになります。
:::message  
最終的な問題設定

$$
\bm{e} \cdot \bm{e} = e_1^2 + e_2^2 = 1
$$

という条件のもとで、

$$
\sum_{i=1}^{k} (\bm{x_i} \cdot \bm{e})^2 = \sum_{i=1}^{k} (x_{i1} e_1+ x_{i2} e_2)^2
$$

が最大となるような $\bm{e}$ を求める。

:::

## ラグランジュ未定乗数法
ある条件 $g(x, y)=0$ のもとで、ある関数 $f(x, y)$ が最大となるような $x, y$ を求める、という問題は、まさに**ラグランジュ未定乗数法**で解けることが知られています。  
これは、 $g(x, y)=0$ のもとで $f(x, y)$ が最大となるとき、必ず $f(x,y)$ の等高線における共偏微分と $g(x,y)$ における共偏微分の向きが一致することを利用した、非常にエレガントな解き方です。
[ラグランジュの未定乗数法(wikipedia)](https://ja.wikipedia.org/wiki/%E3%83%A9%E3%82%B0%E3%83%A9%E3%83%B3%E3%82%B8%E3%83%A5%E3%81%AE%E6%9C%AA%E5%AE%9A%E4%B9%97%E6%95%B0%E6%B3%95#:~:text=%E3%83%A9%E3%82%B0%E3%83%A9%E3%83%B3%E3%82%B8%E3%83%A5%E3%81%AE%E6%9C%AA%E5%AE%9A%E4%B9%97%E6%95%B0%E6%B3%95%EF%BC%88%E3%83%A9%E3%82%B0%E3%83%A9%E3%83%B3%E3%82%B8%E3%83%A5%E3%81%AE%E3%81%BF%E3%81%A6%E3%81%84%E3%81%98%E3%82%87%E3%81%86%E3%81%99%E3%81%86,%E7%9A%84%E3%81%AA%E6%96%B9%E6%B3%95%E3%81%A7%E3%81%82%E3%82%8B%E3%80%82)

## 計算方法
今回の問題設定では、$g, f$ が以下のように対応しています。

$$
\begin{aligned}
g(e_1, e_2) &= e_1^2 + e_2^2 - 1 = 0\\
f(e_1, e_2) &= \sum_{i=1}^{k} (x_{i1} e_1+ x_{i2} e_2)^2
\end{aligned}
$$

したがって、ラグランジュ未定乗数法を用いると問題は以下のように連立方程式で書けます。

$$
L(e_1, e_2, \lambda) = \sum_{i=1}^{k} (x_{i1} e_1+ x_{i2} e_2)^2 - \lambda 
(e_1^2 + e_2^2 - 1)\\
$$

として、

$$
\frac{\partial L}{\partial e_1} = \frac{\partial L}{\partial e_2} = \frac{\partial L}{\partial \lambda} = 0
$$

分散共分散行列を使って書け。俺

### 寄与度

### 累積寄与度